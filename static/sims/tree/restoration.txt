actions.precombat=flask
actions.precombat+=/food
actions.precombat+=/augmentation
actions.precombat+=/snapshot_stats
actions.precombat+=/cat_form,if=talent.feral_affinity.enabled
actions.precombat+=/prowl,if=talent.feral_affinity.enabled
actions.precombat+=/moonkin_form,if=talent.balance_affinity.enabled

actions=berserking
actions+=/use_items,if=!buff.prowl.up&!buff.shadowmeld.up
actions+=/potion
actions+=/run_action_list,name=owl,if=talent.balance_affinity.enabled
actions+=/run_action_list,name=cat,if=talent.feral_affinity.enabled
actions+=/convoke_the_spirits,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60-30*runeforge.celestial_spirits|!talent.heart_of_the_wild.enabled)&(!equipped.soulleting_ruby|cooldown.soulleting_ruby.remains<114&!cooldown.soulleting_ruby.ready)
actions+=/adaptive_swarm,target_if=!dot.adaptive_swarm_damage.ticking&!action.adaptive_swarm_damage.in_flight&(!dot.adaptive_swarm_heal.ticking|dot.adaptive_swarm_heal.remains>5|dot.adaptive_swarm_heal.stack=1)|dot.adaptive_swarm_damage.stack<3&dot.adaptive_swarm_damage.remains<3&dot.adaptive_swarm_damage.ticking
actions+=/ravenous_frenzy,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60|!talent.heart_of_the_wild.enabled)
actions+=/kindred_spirits,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60|!talent.heart_of_the_wild.enabled)
actions+=/sunfire,target_if=refreshable
actions+=/moonfire,target_if=refreshable
actions+=/wrath
actions+=/moonfire

actions.cat=rake,if=buff.shadowmeld.up|buff.prowl.up
actions.cat+=/auto_attack,if=!buff.prowl.up&!buff.shadowmeld.up
actions.cat+=/adaptive_swarm,target_if=!dot.adaptive_swarm_damage.ticking&!action.adaptive_swarm_damage.in_flight&(!dot.adaptive_swarm_heal.ticking|dot.adaptive_swarm_heal.remains>5|dot.adaptive_swarm_heal.stack=1)|dot.adaptive_swarm_damage.stack<3&dot.adaptive_swarm_damage.remains<3&dot.adaptive_swarm_damage.ticking
actions.cat+=/kindred_spirits,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60|!talent.heart_of_the_wild.enabled)
actions.cat+=/sunfire,target_if=refreshable&target.time_to_die>5
actions.cat+=/moonfire,target_if=refreshable&time_to_die>12&(spell_targets.swipe_cat<=4|energy<50)&!ticking|(prev_gcd.1.sunfire&remains<duration*0.8&spell_targets.sunfire=1)
actions.cat+=/sunfire,if=prev_gcd.1.moonfire&remains<duration*0.8
actions.cat+=/ravenous_frenzy,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60|!talent.heart_of_the_wild.enabled)
actions.cat+=/convoke_the_spirits,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60-30*runeforge.celestial_spirits|!talent.heart_of_the_wild.enabled)&buff.cat_form.up&energy<50&(combo_points<5&dot.rip.remains>5|spell_targets.swipe_cat>1)
actions.cat+=/heart_of_the_wild,if=(cooldown.convoke_the_spirits.remains<30|!covenant.night_fae)&!buff.heart_of_the_wild.up&dot.sunfire.ticking&(dot.moonfire.ticking|spell_targets.swipe_cat>4)
actions.cat+=/cat_form,if=!buff.cat_form.up&energy>50
actions.cat+=/wrath,if=!buff.cat_form.up
actions.cat+=/ferocious_bite,if=(combo_points>3&target.1.time_to_die<3|combo_points=5&energy>=50&dot.rip.remains>10)&spell_targets.swipe_cat<4
actions.cat+=/rip,target_if=((refreshable|energy>90&remains<=10)&(combo_points=5&time_to_die>remains+24|(remains+combo_points*4<time_to_die&remains+4+combo_points*4>time_to_die))|!ticking&combo_points>2+spell_targets.swipe_cat*2)&spell_targets.swipe_cat<11
actions.cat+=/rake,target_if=refreshable&time_to_die>10&(combo_points<5|remains<1)&spell_targets.swipe_cat<5
actions.cat+=/swipe_cat,if=spell_targets.swipe_cat>=2
actions.cat+=/rake,target_if=dot.adaptive_swarm_damage.ticking&runeforge.draught_of_deep_focus,if=(combo_points<5|energy>90)&runeforge.draught_of_deep_focus&dot.rake.pmultiplier<=persistent_multiplier
actions.cat+=/shred,if=combo_points<5|energy>90

actions.owl=heart_of_the_wild,if=(cooldown.convoke_the_spirits.remains<30|cooldown.convoke_the_spirits.remains>90|!covenant.night_fae)&!buff.heart_of_the_wild.up
actions.owl+=/cat_form,if=runeforge.oath_of_the_elder_druid&!buff.oath_of_the_elder_druid.up
actions.owl+=/moonkin_form,if=!buff.moonkin_form.up
actions.owl+=/convoke_the_spirits,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60-30*runeforge.celestial_spirits|!talent.heart_of_the_wild.enabled)&(buff.eclipse_solar.remains>4|buff.eclipse_lunar.remains>4)&(!equipped.soulleting_ruby|cooldown.soulleting_ruby.remains<114-60*runeforge.celestial_spirits&!cooldown.soulleting_ruby.ready)
actions.owl+=/adaptive_swarm,target_if=!dot.adaptive_swarm_damage.ticking&!action.adaptive_swarm_damage.in_flight&(!dot.adaptive_swarm_heal.ticking|dot.adaptive_swarm_heal.remains>5|dot.adaptive_swarm_heal.stack=1)|dot.adaptive_swarm_damage.stack<3&dot.adaptive_swarm_damage.remains<3&dot.adaptive_swarm_damage.ticking
actions.owl+=/ravenous_frenzy,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60|!talent.heart_of_the_wild.enabled)
actions.owl+=/kindred_spirits,if=(buff.heart_of_the_wild.up|cooldown.heart_of_the_wild.remains>60|!talent.heart_of_the_wild.enabled)
actions.owl+=/starsurge,if=spell_targets.starfire<6|!eclipse.in_lunar&spell_targets.starfire<8
actions.owl+=/moonfire,target_if=refreshable&target.time_to_die>5&(spell_targets.starfire<5|!eclipse.in_lunar&spell_targets.starfire<7)
actions.owl+=/sunfire,target_if=refreshable&target.time_to_die>5
actions.owl+=/wrath,if=eclipse.in_solar&spell_targets.starfire=1|eclipse.lunar_next|eclipse.any_next&spell_targets.starfire>1
actions.owl+=/starfire
